name: Wildberries Bot & Report

on:
  schedule:
    - cron: '0 10 * * *'    # –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –≤ 10:00 UTC (13:00 –ú–°–ö)
    - cron: '0 18 * * *'    # –≤–µ—á–µ—Ä–Ω–∏–π –æ—Ç—á–µ—Ç –≤ 18:00 UTC (21:00 –ú–°–ö)
  push:
    branches: [ main ]
  workflow_dispatch:        # –†–∞–∑—Ä–µ—à–∏—Ç—å —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    if: contains(github.event.schedule, '10') || github.event_name == 'workflow_dispatch' || github.event_name == 'push'

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run Wildberries Bot
      env:
        WB_API_KEY: ${{ secrets.WB_API_KEY }}
        SUPPLIER_ID: ${{ secrets.SUPPLIER_ID }}
        AI_PROVIDER: ${{ secrets.AI_PROVIDER || 'free' }}
        YANDEX_API_KEY: ${{ secrets.YANDEX_API_KEY }}
        YANDEX_FOLDER_ID: ${{ secrets.YANDEX_FOLDER_ID }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        CHECK_INTERVAL: 30
        TEST_MODE: false
      run: |
        echo "üöÄ –ó–∞–ø—É—Å–∫ Wildberries Bot..."
        python main.py
        echo "‚úÖ –ë–æ—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É"

  daily-report:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    if: contains(github.event.schedule, '18') || github.event_name == 'workflow_dispatch'

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Send daily report
      env:
        WB_API_KEY: ${{ secrets.WB_API_KEY }}
        SUPPLIER_ID: ${{ secrets.SUPPLIER_ID }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        echo "üìä –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç—á–µ—Ç–∞..."
        python scripts/daily_report.py
        echo "‚úÖ –û—Ç—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"
